!function(){var e=document.documentElement;Element.prototype.matches||(Element.prototype.matches=e.webkitMatchesSelector||e.msMatchesSelector||e.oMatchesSelector);var t=/(\w+)|(::|:)(\w+)(?:\((.+?(?=\)))\))?/g,n=/,\s*/;document.createRange();var r={events:{},pseudos:{delegate:{onInvoke:function(e,t,n){for(var r,o=n.target,s=n.currentTarget;!r&&o&&o!=s;)o.tagName&&o.matches(t.args)&&(r=o),o=o.parentNode;if(!r&&s.tagName&&s.matches(t.args)&&(r=s),!r)return null;t.fn=t.fn.bind(r)}}},extensions:{rxn:{onParse:(e,t,n,r,o)=>(delete e.prototype[o],!1),onConstruct(e,t,n,r){e.rxn(t,r.value,!!n[1])}},attr:{mixin:e=>(class extends e{attributeChangedCallback(e,t,n){var r=this.constructor.getOptions("attributes")[e];r&&r.set&&!r._skip&&(r._skip=!0,r.set.call(this,n),r._skip=null)}}),types:{boolean:{set:function(e,t){t||""===t?this.setAttribute(e,""):this.removeAttribute(e)},get:function(e){return this.hasAttribute(e)}}},onParse(e,t,n,r,o){if(r.value)throw'Attribute accessor "'+t+'" was declared as a value, but must be declared as get or set';e.getOptions("attributes")[t]=r;var s=this.types[n[0]]||{};let i=r.set,a=s.set||HTMLElement.prototype.setAttribute;r.set=function(e){var n;r._skip||(r._skip=!0,i&&(n=i.call(this,e)),a.call(this,t,void 0===n?e:n),r._skip=null)};let l=r.get,c=s.get||HTMLElement.prototype.getAttribute;r.get=function(){var e,n=c.call(this,t);return l&&(e=l.call(this,n)),void 0===e?n:e},delete e.prototype[o]},onCompiled(e){e.observedAttributes=Object.keys(e.getOptions("attributes")).concat(e.observedAttributes||[])}},event:{onParse:(e,t,n,r,o)=>(delete e.prototype[o],!1),onConstruct(e,t,n,o){r.addEvent(e,t,o.value)}},template:{render:function(e,t,n){e.innerHTML=t.call(e),e._XTagRender=null,n.resolve&&n.resolve(e)},throttle:{frame:function(e,t,n,o){n.cancel=cancelAnimationFrame.bind(window,requestAnimationFrame(()=>{r.extensions.template.render(e,t,n)}))},debounce:function(e,t,n,o){n.cancel=clearTimeout.bind(window,setTimeout(()=>{r.extensions.template.render(e,t,n)},o.throttle))}},mixin:e=>(class extends e{set"template::attr"(e){this.render(e)}get templates(){return this.constructor.getOptions("templates")}render(e,t={}){var n=e||"default",o=this.templates[n];if(!o)throw new ReferenceError((n?'Template "'+n+'" undefined for ':"No templates defined for ")+this.nodeName);this.getAttribute("template")!=n&&this.setAttribute("template",n);var s=r.extensions.template,i=t.throttle?s.throttle[t.throttle]||s.throttle.debounce:s.render,a=this._XTagRender;if(a){if(a.name===n)return a.promise;a.cancel&&a.cancel()}return a=this._XTagRender={name:n},t.throttle?a.promise=new Promise(e=>{a.resolve=e,i(this,o,a,t)}):(i(this,o,a,t),Promise.resolve(this))}}),onParse:(e,t,n,r)=>(e.getOptions("templates")[t||"default"]=r.value,!1),onReady(e,t,n,r){r[0]&&("ready"===r[0]?e.render(n):e.rxn("firstpaint",()=>e.render(n))),t()}}},create(e,t){var n=t||e;return n.options=Object.assign({},n.options),a(n),t&&e&&customElements.define(e,n),n},register(e,t){customElements.define(e,t)},addEvents(e,t){let n={};for(let o in t)n[o]=r.addEvent(e,o,t[o]);return n},addEvent(e,o,s,a){var l,c=s,u={data:{},capture:a},p=e.constructor.getOptions("pseudos");o.replace(t,(t,o,s,a,d)=>{if(o)l=o;else{var f=p[f=s||d]||r.pseudos[f],m=a?a.split(n):[];c=i(f,m,c,u),f.onParse&&f.onParse(e,l,m,c,u)}}),e.addEventListener(l,c,a),u.type=l,u.listener=c;var d=e.constructor.getOptions("events")[l]||r.events[l];if(d){var f=function(e){new Promise((t,n)=>{d.onFilter(this,e,u,t,n)}).then(()=>{r.fireEvent(e.target,l)})};u.attached=d.attach.map(t=>r.addEvent(e,t,f,!0)),d.onAdd&&d.onAdd(e,u)}return u},removeEvents(e,t){for(let n in t)r.removeEvent(e,t[n])},removeEvent(e,t){e.removeEventListener(t.type,t.listener,t.capture);var n=e.constructor.getOptions("events")[t.type]||r.events[t.type];n&&n.onRemove&&n.onRemove(e,t),t.attached&&t.attached.forEach(n=>{r.removeEvent(e,t)})},fireEvent(e,t,n={}){let r=Object.assign({bubbles:!0,cancelable:!0},n);e.dispatchEvent(new CustomEvent(t,r))}},o=0;function s(e,t){var n=e.rxns[t],r=n.queue;for(let t in r)r[t].fn.call(e),!n.singleton&&r[t].recurring||delete r[t];n.fired=!0}function i(e,t,n,r){return function(){var o={fn:n,args:t,detail:r},s=e.onInvoke(this,o,...arguments);return null===s||!1===s?s:o.fn.apply(this,s instanceof Array?s:arguments)}}function a(e){var o={},s=function(e){var t={},n=e.prototype;return Object.getOwnPropertyNames(n).forEach(e=>{t[e]=Object.getOwnPropertyDescriptor(n,e)}),t}(e),a=e.getOptions("extensions"),l=e._processedExtensions=new Map;for(let c in s){let u,p,d,f=[],m=[],v=s[c],h=e._pseudos||r.pseudos;if(c.replace(t,function(){f.unshift(arguments)}),f.forEach(t=>(function(t,o,s,c,d){if(u=o||u,d)var f=d.split(n);if("::"==s)m=f||[],p=a[c]||r.extensions[c],l.get(p)||l.set(p,[]);else if(!o){let t=h[c];if(t)for(let n in v){let r=v[n];"function"==typeof r&&t.onInvoke&&(r=v[n]=i(t,f,r),t.onParse&&t.onParse(e,u,f,r))}}}).apply(null,t)),p&&(l.get(p).push([u,m,v]),p.onParse&&(d=p.onParse(e,u,m,v,c))),u){if(!1!==d){let e=o[u]||(o[u]={});for(let t in v)e[t]=v[t]}}else delete e.prototype[c]}for(let t of l.keys())t.onCompiled&&t.onCompiled(e,o);Object.defineProperties(e.prototype,o)}XTagElement=function e(t={}){var n;return(n=class extends(t.native?Object.getPrototypeOf(document.createElement(t.native)).constructor:HTMLElement){constructor(){super(),this.rxns||(this.rxns={ready:{queue:{},singleton:!0},firstpaint:{queue:{},singleton:!0},render:{queue:{}}}),function(e){var t=e.constructor._processedExtensions;for(let[n,r]of t)n.onConstruct&&r.forEach(t=>n.onConstruct(e,...t))}(this),new Promise(e=>(function(e,t){var n=e.constructor._processedExtensions;for(let[r,o]of n)r.onReady&&Promise.all(o.map(t=>new Promise(n=>r.onReady(e,n,...t)))).then(()=>t())})(this,e)).then(()=>s(this,"ready"))}connectedCallback(){!function(e){var t=e.constructor._processedExtensions;for(let[n,r]of t)n.onConnect&&r.forEach(t=>n.onConnect(e,...t))}(this),this.rxns.firstpaint.frame||(this.rxns.firstpaint.frame=requestAnimationFrame(()=>s(this,"firstpaint")))}rxn(e,t,n){var r=this.rxns[e];if(!r.singleton||!r.fired)return r.queue[o++]={fn:t,recurring:n},o;t.call(this)}cancelRxn(e,t){delete this.rxns[e].queue[t]}}).options={extensions:{},pseudos:{}},n.getOptions=function(e){return this.options[e]||(this.options[e]=Object.assign({},Object.getPrototypeOf(this).options?Object.getPrototypeOf(this).options[e]:{}))},n.extensions=function(...e){var t=this.getOptions("extensions");return e.reduce((e,n)=>{var o,s=e;return t[n.name]||("string"==typeof n?o=r.extensions[n].mixin:(o=n.mixin,t[n.name]=n),o&&a(s=o(e))),s},this)},n.as=function(t){return e({native:t})},n.extensions("attr","event","template")}(),"function"==typeof define&&define.amd?(define(r),define(XTagElement)):"undefined"!=typeof module&&module.exports?module.exports={xtag:r,XTagElement:XTagElement}:(window.xtag=r,window.XTagElement=XTagElement)}();